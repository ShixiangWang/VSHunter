---
title: "cnPattern: Decode Pattern of Copy Number Profile"
author: "Shixiang Wang \\
        ShanghaiTech. University"
date: "`r Sys.Date()`"

output:
  prettydoc::html_pretty:
    toc: true
    theme: cayman
    highlight: github
  pdf_document:
    toc: true
vignette: >
  %\VignetteIndexEntry{download publical data in batch quickly and easily}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, echo=FALSE, include=FALSE, message=FALSE, warning=FALSE}
# devtools::load_all()
# library(flexmix)
# library(QDNAseq)
# library(NMF)
if(!require("cnPattern")){
  devtools::load_all()
}
```

## Installation


You can install UCSCXenaTools from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("ShixiangWang/UCSCXenaTools", build_vignettes = TRUE)
```

Read this vignettes.

```{r, eval=FALSE}
browseVignettes("UCSCXenaTools")
# or
??UCSCXenaTools
```

Load package.

```{r, eval=FALSE}
library(cnPattern)
```


## Usage

Load example data:

```{r}
load(system.file("inst/extdata", "example_cn_list.RData", package = "cnPattern"))
```

`tcga_segTabs` is a list contain absolute copy number profile for multiple samples, each sample is a `data.frame` in the list.

Derive feature distributions.

```{r}
tcga_features = derive_features(CN_data = tcga_segTabs, cores = 4, genome_build = "hg19")
```

Fit model components.

```{r}
tcga_components = fit_mixModels(CN_features = tcga_features, cores = 4)
```

Generate a sample-by-component matrix representing the sum of posterior probabilities of each copy-number event being assigned to each component.

```{r}
tcga_sample_component_matrix = generate_sbcMatrix(tcga_features, tcga_components, cores = 4)
```


Choose optimal number of signatures.

```{r}
tcga_sig_choose = choose_nSignatures(tcga_sample_component_matrix, nrun = 10, cores = 4)
```

Extract signatures.

```{r}
tcga_signatures = extract_Signatures(tcga_sample_component_matrix, nsig = 3, cores = 4)
```

Quantify exposure for samples.

```{r}
w = NMF::basis(tcga_signatures)
#h = NMF::coef(tcga_signatures)
tcga_exposure = quantify_Signatures(sample_by_component = tcga_sample_component_matrix, component_by_signature = w)
```

Function `autoCapture_Signatures()` finish three steps (choose best number of signatures, extract signatures and quantify exposure) above in an  antomated way. The arguments of this function are same as `choose_nSignatures()`.

```{r, eval=FALSE}
tcga_results = autoCapture_Signatures(tcga_sample_component_matrix, nrun=10, cores = 4)
```

The result object is a `list` which contains all results need fro downstream analysis, include NMF result related to best rank value, signature matrix, absolute and relative exposure (contribution) and best rank survey etc..
 
